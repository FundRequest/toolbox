#!/bin/bash
echo
echo "EthereumJS TestRPC Sandbox Container"
echo "------------------------------------"
CMD=`docker images | grep ethereumjs/testrpc`
if [[ $? != 0 ]]; then
  echo "INFO > 'ethereumjs/testrpc' image not found, creating ..."
  OLD_PWD=$PWD
  SCRIPT_LOC=`dirname $0`
  cd $SCRIPT_LOC/../testrpc
  docker build -t ethereumjs/testrpc .
  cd $OLD_PWD
fi

CMD=`docker ps | grep testrpc.sandbox`
if [[ $?  == 0 ]]; then
  echo "INFO > Stopping container 'testrpc.sandbox'"
  FEEDBACK=`docker stop testrpc.sandbox`
fi 
echo "INFO > Starting container 'testrpc.sandbox'"
CONTAINER_ID=`docker run -d --rm -p 127.0.0.1:8545:8545 --name testrpc.sandbox ethereumjs/testrpc`
echo "INFO > container 'testrpc.sandbox' started with id $CONTAINER_ID"
sleep 5
CMD=`docker ps | grep testrpc.sandbox`
if [[ $? != 0 ]]; then
  echo "ERROR > Can't find container 'testrpc.sandbox', something must be wrong. Exiting."
  exit 1
else
  echo "INFO > Start tailing the container log. Ctrl+C to dettach"
  sleep 2
  docker logs -f testrpc.sandbox
fi

